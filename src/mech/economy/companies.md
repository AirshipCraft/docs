> <span style="color:red">Currently unimplemented.</span>
# Companies

## Overview

Companies are registerable entities that players can create, join, and manage. Companies allow players to enable profit-sharing between company owned stores as well as allowing other players, both inside and outside the company, to buy and sell stock in the company.
   
Players can only create or join one company at any time and can sell ownership of their company or transfer it to other players. CEOs (company owners) can invite other players to join their company. 
   
If a player is already in a company and receives an invitation to join another company and that player accepts the invite, they will leave whatever company they are currently in and join the new company. If the invited player happens to be a CEO of a company then they will be prompted to either first transfer ownership or disband their company.
   
By introducing the concept of companies in our economy system, we can create a more diverse and dynamic in-game economy. Players can invest in companies and share in their profits, while companies can expand their reach and profitability by owning and operating in-game shops. We believe this mechanic will add a new level of depth and engagement to our server.

## Registering a Company

To register a company, a player must have a certain amount of money in their account. We can set a minimum amount required to register a company, such as 100,000 in-game currency. Once the player has the required amount, they can run the following command to register a company:

```
/company register [company name] [ticker symbol] [optional: # of shares]
```

This command will create a new company with the specified name and ticker symbol and set the player as the owner, or CEO. The company's information will be stored in a separate database table from the player's information.
   
Notice the optional third argument which is the amount of shares offered as an initial public offering (IPO). Players can set whatever amount of shares they would like but the default value will always be 100,000.
   
In-order to maintain a company, a daily upkeep of `100 x 0.75(amount of members)` will be withdrawn out of the company's bank. To check the balance of the company, you can do the following command:

```
/company bank
```

## Company Owned Shops and Profit Sharing

Once a company is registered, any shops registered to any of its members will automatically be registered to the company. 

Revenue generated by the shops will be then deposited into the corporation [`bank`](/src/mech/economy/banking.md). 
   
There will be a "payday" everyday and a percentage (90% by default) of the total contents of the corporation bank will be distributed equally among the members of the corporation. The CEO of the company can configure this percentage by running the following command:
   
```
/company payout [percentage]
```
   
The CEO can also withdraw the balance of the corporation bank at any time by running this command:
   
```
/company withdraw [amount]
```
The plugin will also keep track of the highest money makers within the company which can be viewed by running the command:
```
/company top [company name]
```
This will show which member of the company is bringing in the most revenue through the shops registered to them.
## Stock Market

Companies have stock value that is determined by how well that company performs based on the following metrics:

1. Size of the company: the amount of shops registered to the company.
2. Weekly revenue of the company: the total weekly sum of the revenue made by the company through the buying and selling of goods via shops.
3. Amount of shares available for purchase: As with the real world stock market, supply and demand plays a big role in determining the price of a stock.
   
Each company by default starts with 100,000 shares available to be bought. Anyone can purchase these stocks including company members. The starting price of a stock is 
   
Players can purchase stocks in registered companies using the following command:

```
/company buy [ticker symbol] [amount]
```
   
This command will purchase that amount of available shares at whatever asking price is available.
    
Players can also sell their stocks back to the company using the following command:

```
/company sell [ticker symbol] [amount]
```

The amount parameter is the number of stocks the player wants to sell.

## Technical Overview

To begin with, we'll need to create a new entity class called `Company`. This class will have attributes such as `name`, `owner`, `stockPrice`, `totalStock`, `sharesSold`, `shops`, and `profits`. The `shops` attribute will be a list of all the shops owned by the company, and the `profits` attribute will be a map that associates each shop with its current profit.

```java
public class Company {
    private String name;
    private UUID owner;
    private double stockPrice;
    private int totalStock;
    private int sharesSold;
    private List<Shop> shops;
    private Map<Shop, Double> profits;
    
    // constructor, getters, and setters
}
```

Next, we'll need to create methods for registering a new company, purchasing stock in a company, and sharing profits from company-owned shops. 

```java
public class CompanyManager {
    private List<Company> companies = new ArrayList<>();

    public void registerCompany(String name, UUID owner, double stockPrice, int totalStock) {
        Company company = new Company(name, owner, stockPrice, totalStock, new ArrayList<>(), new HashMap<>());
        companies.add(company);
    }
    
    public void purchaseStock(Player player, Company company, int numShares) {
        double cost = numShares * company.getStockPrice();
        if (player.getBalance() >= cost && company.getSharesSold() + numShares <= company.getTotalStock()) {
            player.withdraw(cost);
            company.setSharesSold(company.getSharesSold() + numShares);
            double ownership = numShares / (double) company.getTotalStock();
            company.getOwners().put(player.getUniqueId(), ownership);
        }
    }
    
    public void shareProfits() {
        for (Company company : companies) {
            for (Shop shop : company.getShops()) {
                double revenue = shop.getRevenue();
                double profit = revenue - shop.getCost();
                company.getProfits().put(shop, profit);
            }
            double totalProfit = company.getProfits().values().stream().mapToDouble(Double::doubleValue).sum();
            for (Map.Entry<UUID, Double> entry : company.getOwners().entrySet()) {
                Player player = Bukkit.getPlayer(entry.getKey());
                if (player != null) {
                    double share = entry.getValue() * totalProfit;
                    player.deposit(share);
                }
            }
        }
    }
}
```

Finally, we'll need to hook into the main [market](/src/mech/economy/market.md) plugin to make sure that company-owned shops are treated the same way as player-made shops. We can do this by adding a listener that listens for when a shop is created, and then adding that shop to the corresponding company's `shops` list.

```java
public class ShopListener implements Listener {
    private EconomySystem economySystem;

    public ShopListener(EconomySystem economySystem) {
        this.economySystem = economySystem;
    }

    @EventHandler
    public void onShopCreate(ShopCreateEvent event) {
        Player player = event.getPlayer();
        Shop shop = event.getShop();
        for (Company company : economySystem.getCompanies()) {
            if (company.getOwner().equals(player.getUniqueId())) {
                company.getShops().add(shop);
            }
        }
    }
}
```